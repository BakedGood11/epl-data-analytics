---
title: "Arsenal Season Stats, EPL '24-'25"
output:
  pdf_document:
    toc: true
    toc_depth: 2
---
```{r, warning=FALSE, message=FALSE, include=FALSE}
#### Initial package calls
library(DBI)
library(RMariaDB)
library(ggplot2)
library(dplyr)
library(dbplyr)
library(dbplot)
library(tinytex)
```
## Overview ##

A(r)senal Analysis is an analytical exploration of Arsenal's performance in the **2024-2025** season of the **English Premier League**. The team was chosen because of their ability to outperform league leaders and top contenders in the UEFA Champion's League (particularly their 3-0 win over Real Madrid) yet showing recurring inconsistencies in front of goal.

Throughout the season, fans and pundits alike heralded it as *“Arsenal’s year.”* With Manchester City’s dominance waning, the path to the title seemed open. Yet by May, Liverpool sat atop the table while Arsenal once again finished second. The central question, then, is this: how can a squad strong enough to reach the Champions League semi-finals and challenge England’s best still struggle to convert that dominance into goals?

### Data Sources
- EPL Player Match Data: https://www.kaggle.com/datasets/aesika/english-premier-league-player-stats-2425 
(1 row per player, aggregated statistics for the 2024-2025 season)
- EPL Fixture Data: https://www.kaggle.com/datasets/secretglory/epl-fixtures-list-2024-2025 
(Official match schedule as published)
- EPL Match Data: Scraped from https://fbref.com/en/comps/9/2024-2025/schedule/2024-2025-Premier-League-Scores-and-Fixtures 
(Aggregated match statistics, per team, for the entire season)

### Methodology
I scraped aggregated match data from FBRef and used Kaggle datasets for player-level statistics and the official fixture list. The datasets were stored in a Docker-based MariaDB instance in my homelab for reproducible querying. Using VSCode’s SQL extensions, I cleaned and normalized data directly in SQL, then connected RStudio to the database for statistical exploration and visualization.

```{r, warning=FALSE, message=FALSE, include=FALSE}
#### Connecting to the MariaDB server in homelab
readRenviron("~/.Renviron")

con <- dbConnect(
  RMariaDB::MariaDB(),
  host = Sys.getenv("MARIADB_HOST"),
  port = as.numeric(Sys.getenv("MARIADB_PORT")),
  user = Sys.getenv("MARIADB_USER"),
  password = Sys.getenv("MARIADB_PWD"),
  dbname = Sys.getenv("MARIADB_PL_DB")
)
```

```{r, verify, warning=FALSE, message=FALSE, include=FALSE}
#### Verifying connection
dbListTables(con)
```

```{r, tables, message=FALSE, warning=FALSE, include=FALSE}
#### Preparing tables
matches <- tbl(con, "pl_matches")
teams <- tbl(con, "pl_teams")
last_season <- tbl(con, "afc_23_24")

## Initial exploration
last_season_goals_df <- last_season %>% 
  summarize(total_GF = sum(gf, na.rm = FALSE), total_GA = sum(ga, na.rm = FALSE), goal_diff = sum(gf-ga)) %>% 
  collect()

last_season_df <- last_season %>% collect()

total_goals = last_season_df %>% 
  summarize(sum(gf, na.rm = FALSE))
  

goal_efficiency <- last_season_df %>% 
  summarize(
    total_goals = sum(gf, na.rm = FALSE),
    matches = n(),
    avg_goals_match = total_goals / matches
  )

### Collecting Arsenal's scores for home and away matches
arsenal_home <- matches %>% 
  inner_join(teams, by = c("home_team_id" = "team_id")) %>% 
  filter(team_name == "Arsenal") %>% 
  select(match_date, team_name, home_score) %>% 
  rename(Score = home_score) %>% 
  mutate(location = "Home")

arsenal_away <- matches %>% 
  inner_join(teams, by = c("away_team_id" = "team_id")) %>% 
  filter(team_name == "Arsenal") %>% 
  select(match_date, team_name, away_score) %>% 
  rename(Score = away_score) %>% 
  mutate(location = "Away")
  
arsenal_season <- bind_rows(
  collect(arsenal_home),
  collect(arsenal_away)) %>% 
  arrange(match_date) %>%
  collect()
```
## Establishing Context
The talk revolving around Arsenal at the start of the season was a result of an astounding performance in the 2023-2024 season of the Premier League. Finishing the season with a mean of **`r goal_efficiency$avg_goals_match`**, the team was set for a fresh run the following season.  

## Comparing Arsenal's Home vs. Away Performance Throughout The Season
As an overview, we take a look at Arsenal's goal scoring trends over the season. 

```{r, fig.dim, fig.width=9.25, fig.height=5, message=FALSE, echo=FALSE}
ggplot(arsenal_season,
  aes(x = match_date, y = Score, color = location)) +
  geom_line(linewidth = 1) +
  geom_point() +
  scale_x_date(date_breaks = "2 weeks", date_labels = "%b %d") +
  labs(x = "Match Date", y = "Goals Scored") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  geom_smooth(method="gam",
              aes(color = location),
              se=TRUE, 
              na.rm=TRUE, 
              show.legend = TRUE,
              linetype = "dotted") +
  facet_wrap(~location, ncol=1)
```
A downward trend in *Home* goals over the season is visible while *Away* games show an almost flat trend line. Both can be attributed to drastic changes in performance given how high scoring games are countered by multiple low scores, including consecutive zero (0) goals in to *Away* match ups.  


```{r, disconnect, include=FALSE, message=FALSE}
#### Disconnect from the DB
dbDisconnect(con)
```